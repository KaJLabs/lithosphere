#!/usr/bin/env npx tsx
// ============================================================================
// Lithosphere Local Seed Script
// Seeds the local Anvil devnet with funded wallets and a demo LEP100 contract.
// ============================================================================
// Usage:
//   npx tsx scripts/seed-local.ts            # run directly
//   make seed                                # via Makefile
// ============================================================================

import {
  createPublicClient,
  createWalletClient,
  http,
  formatEther,
  parseEther,
  type Address,
  type Hex,
} from "viem";
import { privateKeyToAccount } from "viem/accounts";
import { foundry } from "viem/chains";

// ---------------------------------------------------------------------------
// Configuration
// ---------------------------------------------------------------------------

const RPC_URL = process.env.RPC_URL ?? "http://127.0.0.1:8545";
const CHAIN_ID = Number(process.env.CHAIN_ID ?? 777777);

// ---------------------------------------------------------------------------
// Private keys are loaded from environment variables.
// For local development, copy .env.local.example → .env.local and source it,
// or let the Makefile / docker-compose handle injection.
//
// The default values in .env.local.example are Anvil's well-known accounts
// (publicly documented) and must NEVER be used on mainnet or testnet.
// ---------------------------------------------------------------------------

/** Anvil account 0 — the deployer / faucet. Never use on mainnet. */
const DEPLOYER_KEY: Hex = requireEnvHex("DEPLOYER_PRIVATE_KEY");

/** Five mock developer wallets (Anvil accounts 5-9). */
const MOCK_WALLETS: { name: string; address: Address; key: Hex }[] = [
  {
    name: "Dev-Wallet-1",
    address: (process.env.DEV_WALLET_1_ADDRESS ?? "0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc") as Address,
    key: requireEnvHex("DEV_WALLET_1_KEY"),
  },
  {
    name: "Dev-Wallet-2",
    address: (process.env.DEV_WALLET_2_ADDRESS ?? "0x976EA74026E726554dB657fA54763abd0C3a0aa9") as Address,
    key: requireEnvHex("DEV_WALLET_2_KEY"),
  },
  {
    name: "Dev-Wallet-3",
    address: (process.env.DEV_WALLET_3_ADDRESS ?? "0x14dC79964da2C08b23698B3D3cc7Ca32193d9955") as Address,
    key: requireEnvHex("DEV_WALLET_3_KEY"),
  },
  {
    name: "Dev-Wallet-4",
    address: (process.env.DEV_WALLET_4_ADDRESS ?? "0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f") as Address,
    key: requireEnvHex("DEV_WALLET_4_KEY"),
  },
  {
    name: "Dev-Wallet-5",
    address: (process.env.DEV_WALLET_5_ADDRESS ?? "0xa0Ee7A142d267C1f36714E4a8F75612F20a79720") as Address,
    key: requireEnvHex("DEV_WALLET_5_KEY"),
  },
];

// ---------------------------------------------------------------------------
// Helper — read a required hex-encoded env var or abort with a clear message.
// ---------------------------------------------------------------------------
function requireEnvHex(name: string): Hex {
  const value = process.env[name];
  if (!value) {
    console.error(
      `Missing environment variable: ${name}\n` +
        `   Copy .env.local.example -> .env.local and source it, or set the var directly.\n` +
        `   See: Makulu/scripts/.env.local.example`,
    );
    process.exit(1);
  }
  return value as Hex;
}

const FUND_AMOUNT = parseEther("1000"); // 1,000 LITHO per wallet

// ---------------------------------------------------------------------------
// LEP100 Contract ABI + Bytecode (compiled from contracts/src/Lep100.sol)
// ---------------------------------------------------------------------------

const LEP100_ABI = [
  {
    type: "constructor",
    inputs: [
      { name: "_n", type: "string" },
      { name: "_s", type: "string" },
      { name: "base", type: "string" },
    ],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "name",
    inputs: [],
    outputs: [{ type: "string" }],
    stateMutability: "view",
  },
  {
    type: "function",
    name: "symbol",
    inputs: [],
    outputs: [{ type: "string" }],
    stateMutability: "view",
  },
  {
    type: "function",
    name: "mint",
    inputs: [
      { name: "to", type: "address" },
      { name: "id", type: "uint256" },
      { name: "amount", type: "uint256" },
      { name: "data", type: "bytes" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "balanceOf",
    inputs: [
      { name: "account", type: "address" },
      { name: "id", type: "uint256" },
    ],
    outputs: [{ type: "uint256" }],
    stateMutability: "view",
  },
  {
    type: "function",
    name: "totalSupply",
    inputs: [{ name: "", type: "uint256" }],
    outputs: [{ type: "uint256" }],
    stateMutability: "view",
  },
  {
    type: "function",
    name: "grantRole",
    inputs: [
      { name: "role", type: "bytes32" },
      { name: "account", type: "address" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "MINTER_ROLE",
    inputs: [],
    outputs: [{ type: "bytes32" }],
    stateMutability: "view",
  },
  {
    type: "event",
    name: "TransferSingle",
    inputs: [
      { name: "operator", type: "address", indexed: true },
      { name: "from", type: "address", indexed: true },
      { name: "to", type: "address", indexed: true },
      { name: "id", type: "uint256", indexed: false },
      { name: "value", type: "uint256", indexed: false },
    ],
  },
] as const;

/** Hardhat-compiled bytecode for Lep100.sol (solc 0.8.24, optimizer 200 runs) */
const LEP100_BYTECODE: Hex =
  "0x60806040523480156200001157600080fd5b5060405162001c7e38038062001c7e833981016040819052620000349162000239565b60016200004284826200035b565b5060026200005183826200035b565b5060066200006082826200035b565b506200008d7fa49807205ce4d355092ef5a8a18f56e8913cf4a201fbe287825b095693c2177533620000ee565b620000b97f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a633620000ee565b620000e57f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a33620000ee565b50505062000427565b6000828152602081815260408083206001600160a01b038516845290915290205460ff166200016d576000828152602081815260408083206001600160a01b0385168085529252808320805460ff1916600117905551339285917f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d9190a45b5050565b634e487b7160e01b600052604160045260246000fd5b600082601f8301126200019957600080fd5b81516001600160401b0380821115620001b657620001b662000171565b604051601f8301601f19908116603f01168101908282118183101715620001e157620001e162000171565b8160405283815260209250866020858801011115620001ff57600080fd5b600091505b8382101562000223578582018301518183018401529082019062000204565b6000602085830101528094505050505092915050565b6000806000606084860312156200024f57600080fd5b83516001600160401b03808211156200026757600080fd5b620002758783880162000187565b945060208601519150808211156200028c57600080fd5b6200029a8783880162000187565b93506040860151915080821115620002b157600080fd5b50620002c08682870162000187565b9150509250925092565b600181811c90821680620002df57607f821691505b6020821081036200030057634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111562000356576000816000526020600020601f850160051c81016020861015620003315750805b601f850160051c820191505b8181101562000352578281556001016200033d565b5050505b505050565b81516001600160401b0381111562000377576200037762000171565b6200038f81620003888454620002ca565b8462000306565b602080601f831160018114620003c75760008415620003ae5750858301515b600019600386901b1c1916600185901b17855562000352565b600085815260208120601f198616915b82811015620003f857888601518255948401946001909101908401620003d7565b5085821015620004175787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b61184780620004376000396000f3fe608060405234801561001057600080fd5b50600436106101415760003560e01c80638456cb59116100b8578063d53913931161007c578063d539139314610292578063d547741f146102b9578063e63ab1e9146102cc578063e985e9c5146102f3578063f242432a14610306578063f5298aca1461031957600080fd5b80638456cb591461023c57806391d148541461024457806395d89b4114610257578063a22cb4651461025f578063bd85b0391461027257600080fd5b80633f4ba83a1161010a5780633f4ba83a146101bc5780634e1273f4146101c457806355f804b3146101e45780635c975abb146101f7578063731133e91461021457806375b238fc1461022757600080fd5b8062fdd58e1461014657806306fdde031461016c5780630e89341c146101815780632eb2c2d6146101945780632f2ff15d146101a9575b600080fd5b610159610154366004610fea565b61032c565b6040519081526020015b60405180910390f35b61017461036c565b6040516101639190611038565b61017461018f36600461106b565b6103fa565b6101a76101a2366004611112565b61042e565b005b6101a76101b73660046111cd565b610627565b6101a761066b565b6101d76101d23660046111f9565b610702565b6040516101639190611265565b6101a76101f23660046112a9565b6107d6565b6007546102049060ff1681565b6040519015158152602001610163565b6101a76102223660046112eb565b610859565b6101596000805160206117f283398151915281565b6101a7610981565b6102046102523660046111cd565b610a15565b610174610a3e565b6101a761026d366004611353565b610a4b565b61015961028036600461106b565b60056020526000908152604090205481565b6101597f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a681565b6101a76102c73660046111cd565b610acc565b6101597f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a81565b61020461030136600461138f565b610b81565b6101a76103143660046113b9565b610baf565b6101a7610327366004611431565b610d36565b60006001600160a01b03831661034157600080fd5b5060008181526003602090815260408083206001600160a01b03861684529091529020545b92915050565b6001805461037990611464565b80601f01602080910402602001604051908101604052809291908181526020018280546103a590611464565b80156103f25780601f106103c7576101008083540402835291602001916103f2565b820191906000526020600020905b8154815290600101906020018083116103d557829003601f168201915b505050505081565b6060600661040783610e43565b60405160200161041892919061149e565b6040516020818303038152906040529050919050565b60075460ff161561045a5760405162461bcd60e51b815260040161045190611525565b60405180910390fd5b848314801561048057506001600160a01b03881633148061048057506104808833610b81565b801561049457506001600160a01b03871615155b61049d57600080fd5b60005b858110156105c15760008787838181106104bc576104bc611545565b90506020020135905060008686848181106104d9576104d9611545565b90506020020135905060006003600084815260200190815260200160002060008d6001600160a01b03166001600160a01b031681526020019081526020016000205490508181101561052a57600080fd5b8181036003600085815260200190815260200160002060008e6001600160a01b03166001600160a01b0316815260200190815260200160002081905550816003600085815260200190815260200160002060008d6001600160a01b03166001600160a01b0316815260200190815260200160002060008282546105ad9190611571565b9091555050600190930192506104a0915050565b50866001600160a01b0316886001600160a01b0316336001600160a01b03167f4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb8989898960405161061594939291906115b6565b60405180910390a45050505050505050565b6000805160206117f28339815191526106408133610a15565b61065c5760405162461bcd60e51b8152600401610451906115e8565b6106668383610f4c565b505050565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a6106968133610a15565b6106b25760405162461bcd60e51b8152600401610451906115e8565b60075460ff166106c157600080fd5b6007805460ff191690556040513381527f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa906020015b60405180910390a150565b606083821461071057600080fd5b8367ffffffffffffffff8111156107295761072961160f565b604051908082528060200260200182016040528015610752578160200160208202803683370190505b50905060005b848110156107cd576107a886868381811061077557610775611545565b905060200201602081019061078a9190611625565b85858481811061079c5761079c611545565b9050602002013561032c565b8282815181106107ba576107ba611545565b6020908102919091010152600101610758565b50949350505050565b6000805160206117f28339815191526107ef8133610a15565b61080b5760405162461bcd60e51b8152600401610451906115e8565b6006610818838583611697565b5060007f6bb7ff708619ba0610cba295a58592e0451dee2622938c8755667688daf3529b848460405161084c929190611758565b60405180910390a2505050565b7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a66108848133610a15565b6108a05760405162461bcd60e51b8152600401610451906115e8565b60075460ff16156108c35760405162461bcd60e51b815260040161045190611525565b6001600160a01b0386166108d657600080fd5b60008581526003602090815260408083206001600160a01b038a16845290915281208054869290610908908490611571565b90915550506000858152600560205260408120805486929061092b908490611571565b909155505060408051868152602081018690526001600160a01b0388169160009133917fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62910160405180910390a4505050505050565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a6109ac8133610a15565b6109c85760405162461bcd60e51b8152600401610451906115e8565b60075460ff16156109d857600080fd5b6007805460ff191660011790556040513381527f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258906020016106f7565b6000918252602082815260408084206001600160a01b0393909316845291905290205460ff1690565b6002805461037990611464565b6001600160a01b0382163303610a6057600080fd5b3360008181526004602090815260408083206001600160a01b03871680855290835292819020805460ff191686151590811790915590519081529192917f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a35050565b6000805160206117f2833981519152610ae58133610a15565b610b015760405162461bcd60e51b8152600401610451906115e8565b6000838152602081815260408083206001600160a01b038616845290915290205460ff1615610666576000838152602081815260408083206001600160a01b0386168085529252808320805460ff1916905551339286917ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b9190a4505050565b6001600160a01b03918216600090815260046020908152604080832093909416825291909152205460ff1690565b60075460ff1615610bd25760405162461bcd60e51b815260040161045190611525565b6001600160a01b038616331480610bee5750610bee8633610b81565b610c295760405162461bcd60e51b815260206004820152600c60248201526b1b9bdd08185c1c1c9bdd995960a21b6044820152606401610451565b6001600160a01b038516610c3c57600080fd5b60008481526003602090815260408083206001600160a01b038a16845290915290205483811015610c9e5760405162461bcd60e51b815260206004820152600c60248201526b1a5b9cdd59999a58da595b9d60a21b6044820152606401610451565b60008581526003602090815260408083206001600160a01b038b8116855292528083208785039055908816825281208054869290610cdd908490611571565b909155505060408051868152602081018690526001600160a01b0380891692908a169133917fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62910160405180910390a450505050505050565b60075460ff1615610d595760405162461bcd60e51b815260040161045190611525565b6001600160a01b038316331480610d755750610d758333610b81565b610d7e57600080fd5b60008281526003602090815260408083206001600160a01b038716845290915290205481811015610dae57600080fd5b60008381526003602090815260408083206001600160a01b038816845282528083208585039055858352600590915281208054849290610def908490611787565b909155505060408051848152602081018490526000916001600160a01b0387169133917fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62910160405180910390a450505050565b606081600003610e6a5750506040805180820190915260018152600360fc1b602082015290565b8160005b8115610e945780610e7e8161179a565b9150610e8d9050600a836117c9565b9150610e6e565b60008167ffffffffffffffff811115610eaf57610eaf61160f565b6040519080825280601f01601f191660200182016040528015610ed9576020820181803683370190505b5090505b8415610f4457610eee600183611787565b9150610efb600a866117dd565b610f06906030611571565b60f81b818381518110610f1b57610f1b611545565b60200101906001600160f81b031916908160001a905350610f3d600a866117c9565b9450610edd565b949350505050565b6000828152602081815260408083206001600160a01b038516845290915290205460ff16610fca576000828152602081815260408083206001600160a01b0385168085529252808320805460ff1916600117905551339285917f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d9190a45b5050565b80356001600160a01b0381168114610fe557600080fd5b919050565b60008060408385031215610ffd57600080fd5b61100683610fce565b946020939093013593505050565b60005b8381101561102f578181015183820152602001611017565b50506000910152565b6020815260008251806020840152611057816040850160208701611014565b601f01601f19169190910160400192915050565b60006020828403121561107d57600080fd5b5035919050565b60008083601f84011261109657600080fd5b50813567ffffffffffffffff8111156110ae57600080fd5b6020830191508360208260051b85010111156110c957600080fd5b9250929050565b60008083601f8401126110e257600080fd5b50813567ffffffffffffffff8111156110fa57600080fd5b6020830191508360208285010111156110c957600080fd5b60008060008060008060008060a0898b03121561112e57600080fd5b61113789610fce565b975061114560208a01610fce565b9650604089013567ffffffffffffffff8082111561116257600080fd5b61116e8c838d01611084565b909850965060608b013591508082111561118757600080fd5b6111938c838d01611084565b909650945060808b01359150808211156111ac57600080fd5b506111b98b828c016110d0565b999c989b5096995094979396929594505050565b600080604083850312156111e057600080fd5b823591506111f060208401610fce565b90509250929050565b6000806000806040858703121561120f57600080fd5b843567ffffffffffffffff8082111561122757600080fd5b61123388838901611084565b9096509450602087013591508082111561124c57600080fd5b5061125987828801611084565b95989497509550505050565b6020808252825182820181905260009190848201906040850190845b8181101561129d57835183529284019291840191600101611281565b50909695505050505050565b600080602083850312156112bc57600080fd5b823567ffffffffffffffff8111156112d357600080fd5b6112df858286016110d0565b90969095509350505050565b60008060008060006080868803121561130357600080fd5b61130c86610fce565b94506020860135935060408601359250606086013567ffffffffffffffff81111561133657600080fd5b611342888289016110d0565b969995985093965092949392505050565b6000806040838503121561136657600080fd5b61136f83610fce565b91506020830135801515811461138457600080fd5b809150509250929050565b600080604083850312156113a257600080fd5b6113ab83610fce565b91506111f060208401610fce565b60008060008060008060a087890312156113d257600080fd5b6113db87610fce565b95506113e960208801610fce565b94506040870135935060608701359250608087013567ffffffffffffffff81111561141357600080fd5b61141f89828a016110d0565b979a9699509497509295939492505050565b60008060006060848603121561144657600080fd5b61144f84610fce565b95602085013595506040909401359392505050565b600181811c9082168061147857607f821691505b60208210810361149857634e487b7160e01b600052602260045260246000fd5b50919050565b60008084546114ac81611464565b600182811680156114c457600181146114d957611508565b60ff1984168752821515830287019450611508565b8860005260208060002060005b858110156114ff5781548a8201529084019082016114e6565b50505082870194505b50505050835161151c818360208801611014565b01949350505050565b6020808252600690820152651c185d5cd95960d21b604082015260600190565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b808201808211156103665761036661155b565b81835260006001600160fb1b0383111561159d57600080fd5b8260051b80836020870137939093016020019392505050565b6040815260006115ca604083018688611584565b82810360208401526115dd818587611584565b979650505050505050565b6020808252600d908201526c1858d8d95cdcc819195b9a5959609a1b604082015260600190565b634e487b7160e01b600052604160045260246000fd5b60006020828403121561163757600080fd5b61164082610fce565b9392505050565b601f821115610666576000816000526020600020601f850160051c810160208610156116705750805b601f850160051c820191505b8181101561168f5782815560010161167c565b505050505050565b67ffffffffffffffff8311156116af576116af61160f565b6116c3836116bd8354611464565b83611647565b6000601f8411600181146116f757600085156116df5750838201355b600019600387901b1c1916600186901b178355611751565b600083815260209020601f19861690835b828110156117285786850135825560209485019460019092019101611708565b50868210156117455760001960f88860031b161c19848701351681555b505060018560011b0183555b5050505050565b60208152816020820152818360408301376000818301604090810191909152601f909201601f19160101919050565b818103818111156103665761036661155b565b6000600182016117ac576117ac61155b565b5060010190565b634e487b7160e01b600052601260045260246000fd5b6000826117d8576117d86117b3565b500490565b6000826117ec576117ec6117b3565b50069056fea49807205ce4d355092ef5a8a18f56e8913cf4a201fbe287825b095693c21775a264697066735822122042a1eefc03aa25fbb8acdeffc38cd255f84f884cb24a5b50b511448d9fa7240364736f6c63430008180033";

// ---------------------------------------------------------------------------
// Litho Devnet chain definition (custom chain matching Anvil config)
// ---------------------------------------------------------------------------

const lithoDevnet = {
  ...foundry,
  id: CHAIN_ID,
  name: "Litho Devnet",
  nativeCurrency: { name: "LITHO", symbol: "LITHO", decimals: 18 },
} as const;

// ---------------------------------------------------------------------------
// Helpers
// ---------------------------------------------------------------------------

function banner(msg: string) {
  const line = "=".repeat(68);
  console.log(`\n${line}\n  ${msg}\n${line}`);
}

function info(msg: string) {
  console.log(`  ✓ ${msg}`);
}

function step(msg: string) {
  console.log(`\n  → ${msg}`);
}

// ---------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------

async function main() {
  banner("Lithosphere Local Seed Script");

  // --- Clients ---
  const transport = http(RPC_URL);
  const deployer = privateKeyToAccount(DEPLOYER_KEY);

  const publicClient = createPublicClient({
    chain: lithoDevnet,
    transport,
  });

  const walletClient = createWalletClient({
    account: deployer,
    chain: lithoDevnet,
    transport,
  });

  // --- Verify connectivity ---
  const chainId = await publicClient.getChainId();
  const blockNumber = await publicClient.getBlockNumber();
  info(`Connected to chain ${chainId} at ${RPC_URL} (block #${blockNumber})`);
  info(`Deployer: ${deployer.address}`);

  // =========================================================================
  // STEP 1 — Fund mock wallets with native LITHO
  // =========================================================================
  banner("Step 1: Fund Mock Wallets (1,000 LITHO each)");

  for (const wallet of MOCK_WALLETS) {
    step(`Funding ${wallet.name} (${wallet.address})...`);

    const hash = await walletClient.sendTransaction({
      to: wallet.address,
      value: FUND_AMOUNT,
    });

    const receipt = await publicClient.waitForTransactionReceipt({ hash });
    const balance = await publicClient.getBalance({
      address: wallet.address,
    });

    info(
      `tx ${receipt.transactionHash.slice(0, 18)}…  ` +
        `status=${receipt.status}  balance=${formatEther(balance)} LITHO`
    );
  }

  // =========================================================================
  // STEP 2 — Deploy LEP100 demo token
  // =========================================================================
  banner("Step 2: Deploy LEP100 Demo Token");

  step("Deploying Lep100('Litho Demo Token', 'LDT', 'https://litho.dev/meta/')...");

  const deployHash = await walletClient.deployContract({
    abi: LEP100_ABI,
    bytecode: LEP100_BYTECODE,
    args: ["Litho Demo Token", "LDT", "https://litho.dev/meta/"],
  });

  const deployReceipt = await publicClient.waitForTransactionReceipt({
    hash: deployHash,
  });

  const contractAddress = deployReceipt.contractAddress!;
  info(`LEP100 deployed at ${contractAddress}  (block #${deployReceipt.blockNumber})`);

  // =========================================================================
  // STEP 3 — Mint LEP100 tokens to each wallet
  // =========================================================================
  banner("Step 3: Mint LEP100 Tokens to Dev Wallets");

  const TOKEN_ID = 1n; // token id 1 = "LITHO Demo NFT"
  const MINT_AMOUNT = 1_000n;

  for (const wallet of MOCK_WALLETS) {
    step(`Minting ${MINT_AMOUNT} LEP100 (id=${TOKEN_ID}) → ${wallet.name}...`);

    const mintHash = await walletClient.writeContract({
      address: contractAddress,
      abi: LEP100_ABI,
      functionName: "mint",
      args: [wallet.address, TOKEN_ID, MINT_AMOUNT, "0x"],
    });

    const mintReceipt = await publicClient.waitForTransactionReceipt({
      hash: mintHash,
    });

    const balance = await publicClient.readContract({
      address: contractAddress,
      abi: LEP100_ABI,
      functionName: "balanceOf",
      args: [wallet.address, TOKEN_ID],
    });

    info(
      `tx ${mintReceipt.transactionHash.slice(0, 18)}…  ` +
        `LEP100 balance=${balance}`
    );
  }

  // =========================================================================
  // STEP 4 — Generate extra transactions for explorer richness
  // =========================================================================
  banner("Step 4: Generate Explorer Activity (inter-wallet transfers)");

  // A few wallet-to-wallet native transfers to create varied txn history
  const transfers = [
    { from: MOCK_WALLETS[0], to: MOCK_WALLETS[1], amount: parseEther("50") },
    { from: MOCK_WALLETS[1], to: MOCK_WALLETS[2], amount: parseEther("25") },
    { from: MOCK_WALLETS[2], to: MOCK_WALLETS[3], amount: parseEther("10") },
    { from: MOCK_WALLETS[3], to: MOCK_WALLETS[4], amount: parseEther("5") },
    { from: MOCK_WALLETS[4], to: MOCK_WALLETS[0], amount: parseEther("2") },
  ];

  for (const tx of transfers) {
    step(`${tx.from.name} → ${tx.to.name}  (${formatEther(tx.amount)} LITHO)`);

    const senderAccount = privateKeyToAccount(tx.from.key);
    const senderClient = createWalletClient({
      account: senderAccount,
      chain: lithoDevnet,
      transport,
    });

    const hash = await senderClient.sendTransaction({
      to: tx.to.address,
      value: tx.amount,
    });

    const receipt = await publicClient.waitForTransactionReceipt({ hash });
    info(`tx ${receipt.transactionHash.slice(0, 18)}…  status=${receipt.status}`);
  }

  // =========================================================================
  // Summary
  // =========================================================================
  banner("Seed Complete!");

  const finalBlock = await publicClient.getBlockNumber();
  console.log(`
  Chain ID:         ${chainId}
  RPC:              ${RPC_URL}
  LEP100 Contract:  ${contractAddress}
  Token ID:         ${TOKEN_ID}
  Blocks produced:  ${finalBlock}

  Mock Wallets:`);

  for (const w of MOCK_WALLETS) {
    const bal = await publicClient.getBalance({ address: w.address });
    const tokBal = await publicClient.readContract({
      address: contractAddress,
      abi: LEP100_ABI,
      functionName: "balanceOf",
      args: [w.address, TOKEN_ID],
    });
    console.log(`    ${w.name}: ${formatEther(bal)} LITHO  |  ${tokBal} LEP100`);
  }

  console.log(`\n  Explorer: http://localhost:3000\n`);
}

main().catch((err) => {
  console.error("\n  ✗ Seed failed:", err.message ?? err);
  process.exit(1);
});
